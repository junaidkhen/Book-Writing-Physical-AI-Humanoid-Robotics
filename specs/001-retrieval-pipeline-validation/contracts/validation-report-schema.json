{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Validation Report Schema",
  "description": "JSON schema for retrieval pipeline validation report data structure",
  "type": "object",
  "required": [
    "report_timestamp",
    "total_queries",
    "successful_queries",
    "failed_queries",
    "skipped_queries",
    "performance_metrics",
    "quality_metrics",
    "integrity_metrics",
    "success_criteria_status"
  ],
  "properties": {
    "report_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when validation was executed"
    },
    "total_queries": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of queries attempted"
    },
    "successful_queries": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of queries that completed successfully"
    },
    "failed_queries": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of queries that encountered errors"
    },
    "skipped_queries": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of queries skipped due to validation failures"
    },
    "performance_metrics": {
      "type": "object",
      "required": ["average_latency_ms", "p50_latency_ms", "p95_latency_ms", "min_latency_ms", "max_latency_ms"],
      "properties": {
        "average_latency_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Mean query latency in milliseconds"
        },
        "p50_latency_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Median query latency (50th percentile)"
        },
        "p95_latency_ms": {
          "type": "number",
          "minimum": 0,
          "description": "95th percentile query latency"
        },
        "min_latency_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Fastest query latency"
        },
        "max_latency_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Slowest query latency"
        }
      }
    },
    "quality_metrics": {
      "type": "object",
      "required": ["average_similarity_score", "score_distribution", "monotonic_decrease_pass_rate"],
      "properties": {
        "average_similarity_score": {
          "type": "number",
          "minimum": -1,
          "maximum": 1,
          "description": "Mean cosine similarity score across all retrieved chunks"
        },
        "score_distribution": {
          "type": "object",
          "required": ["High", "Medium", "Low", "Incorrect"],
          "properties": {
            "High": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of chunks with score >= 0.78"
            },
            "Medium": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of chunks with 0.60 <= score < 0.78"
            },
            "Low": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of chunks with 0.40 <= score < 0.60"
            },
            "Incorrect": {
              "type": "integer",
              "minimum": 0,
              "description": "Count of chunks with score < 0.40"
            }
          }
        },
        "monotonic_decrease_pass_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Fraction of queries with monotonic score decrease (SC-003 target: 0.90)"
        },
        "top3_relevance_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Fraction of queries with relevant top-3 results (manual validation, SC-006 target: 0.80)"
        }
      }
    },
    "integrity_metrics": {
      "type": "object",
      "required": [
        "total_vectors_in_collection",
        "sample_size",
        "valid_payload_count",
        "valid_payload_percentage",
        "missing_url_count",
        "missing_text_count"
      ],
      "properties": {
        "total_vectors_in_collection": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of vectors stored in Qdrant collection"
        },
        "sample_size": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of vectors sampled for integrity check (5% of total)"
        },
        "valid_payload_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of sampled vectors with complete metadata"
        },
        "valid_payload_percentage": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of sampled vectors with valid payloads (SC-002 target: 100.0)"
        },
        "missing_url_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of vectors with missing or empty source_url"
        },
        "missing_text_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of vectors with missing or empty text"
        }
      }
    },
    "success_criteria_status": {
      "type": "object",
      "required": ["SC-001", "SC-002", "SC-003", "SC-004", "SC-005", "SC-006", "SC-007", "SC-008"],
      "properties": {
        "SC-001": {
          "type": "boolean",
          "description": "100% of test queries successfully retrieve results (when relevant content exists)"
        },
        "SC-002": {
          "type": "boolean",
          "description": "100% of retrieved chunks contain complete metadata"
        },
        "SC-003": {
          "type": "boolean",
          "description": "Similarity scores demonstrate monotonic decrease for 90%+ of queries"
        },
        "SC-004": {
          "type": "boolean",
          "description": "Average retrieval latency is under 500 milliseconds"
        },
        "SC-005": {
          "type": "boolean",
          "description": "Validation report confirms zero data integrity issues"
        },
        "SC-006": {
          "type": "boolean",
          "description": "At least 80% of queries return semantically relevant top-3 results (manual validation)"
        },
        "SC-007": {
          "type": "boolean",
          "description": "All test queries complete without system errors"
        },
        "SC-008": {
          "type": "boolean",
          "description": "Qdrant collection schema validation passes"
        }
      }
    }
  }
}
